#!/bin/bash
# Begin LSF Directives
#SBATCH -A nph159
#SBATCH -t 02:00:00
#SBATCH -J proton
#SBATCH -o testproton.%J
#SBATCH -e testproton.%J
#SBATCH -N 32
#SBATCH -n 256
#SBATCH --exclusive
#SBATCH --gpu-bind=map_gpu:0,1,2,3,7,6,5,4
##SBATCH -q debug
#export BIND="--cpu-bind=verbose,map_ldom:3,3,1,1,2,2,0,0"

module load PrgEnv-gnu craype-accel-amd-gfx90a amd-mixed rocm cray-python cray-mpich
export MPICH_GPU_SUPPORT_ENABLED=1
source /ccs/home/dbollweg/gpt/lib/cgpt/build/source.sh
export PYTHONPATH=${PYTHONPATH}:/ccs/home/dbollweg/TMD_work/gpt_utils:/ccs/home/dbollweg/TMD_work/gpt_utils/qTMD:/ccs/home/dbollweg/TMD_work/gpt_utils/utils

export OMP_NUM_THREADS=16
srun -N 32 -n 256 --gpus-per-task=1 python3 proton2pttest.py --mpi 2.4.4.8 --mpi_split 2.2.4.4 --grid 64.64.64.128 --shm-mpi 1 --shm 2048 --comms-sequential --accelerator-threads 8

